<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Images</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="bg-gray-100">

<section class="bg-white p-6 rounded-lg shadow-md max-w-6xl mx-auto mt-8">
    <h2 class="text-2xl font-bold mb-4">All Images</h2>

    <!-- Search Form -->
    <form id="searchForm" class="mb-6">
        <input type="text" id="searchInput" placeholder="Search images..." class="w-full p-2 border rounded-lg shadow-md" />
        <button type="submit" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Search</button>
    </form>

    <!-- Images List -->
    <ul id="imageList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        <!-- Images will be dynamically loaded here -->
    </ul>

    <!-- Pagination -->
    <div id="pagination" class="mt-6 flex justify-center hidden">
        <button id="prevPage" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 hidden">&laquo; Previous</button>
        <span id="pageInfo" class="px-4 py-2"></span>
        <button id="nextPage" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 hidden">Next &raquo;</button>
    </div>
</section>

<script>
    const apiUrl = "http://localhost:8000/app/images/"; // Replace with your actual API endpoint
    let currentPage = 1;
    let currentSearchQuery = "";

    // Fetch images from the API
    async function fetchImages(page, searchQuery) {
        try {
            const response = await fetch(`${apiUrl}?page=${page}&search=${searchQuery}`);
            if (!response.ok) {
                console.error("Failed to fetch images:", response.statusText);
                return { images: [] };
            }
            return await response.json();
        } catch (error) {
            console.error("An error occurred while fetching images:", error);
            return { images: [] };
        }
    }

    // Render images to the DOM
    function renderImages(images) {
        const imageList = document.getElementById("imageList");
        imageList.innerHTML = "";

        // Display a message if no images are found
        if (!images || images.length === 0) {
            imageList.innerHTML = "<p>No images found matching your criteria.</p>";
            return;
        }

        images.forEach(image => {
            const li = document.createElement("li");
            li.className = "border rounded-lg overflow-hidden shadow-md";
            li.innerHTML = `
                <article class="post">
                    <a href="/images/${image.id}" class="block hover:opacity-90">
                        <img src="${image.url}" alt="${image.title}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h3 class="font-bold text-lg">${image.title}</h3>
                            <p class="text-gray-600">${image.description || "No description available"}</p>
                        </div>
                    </a>
                </article>
            `;
            imageList.appendChild(li);
        });
    }

    // Update pagination controls
    function updatePagination(hasNextPage) {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        if (currentPage > 1) {
            const prevButton = document.createElement("button");
            prevButton.textContent = "« Previous";
            prevButton.className = "px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300";
            prevButton.addEventListener("click", () => {
                currentPage--;
                loadImages();
            });
            pagination.appendChild(prevButton);
        }

        const pageInfo = document.createElement("span");
        pageInfo.textContent = `Page ${currentPage}`;
        pageInfo.className = "px-4 py-2";
        pagination.appendChild(pageInfo);

        if (hasNextPage) {
            const nextButton = document.createElement("button");
            nextButton.textContent = "Next »";
            nextButton.className = "px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300";
            nextButton.addEventListener("click", () => {
                currentPage++;
                loadImages();
            });
            pagination.appendChild(nextButton);
        }
    }

    // Load images and render them
    async function loadImages() {
        const data = await fetchImages(currentPage, currentSearchQuery);

        // Safeguard to ensure `images` exists
        const images = data.images || [];

        renderImages(images);
        updatePagination(images.length > 0); // Check if there are images to determine pagination
    }

    // Handle the search form submission
    document.getElementById("searchForm").addEventListener("submit", (event) => {
        event.preventDefault();
        const searchInput = document.getElementById("searchInput");
        currentSearchQuery = searchInput.value.trim();
        currentPage = 1; // Reset to the first page for a new search
        loadImages();
    });

    // Initial load
    document.addEventListener("DOMContentLoaded", () => {
        loadImages();
    });
</script>



</body>
</html>
